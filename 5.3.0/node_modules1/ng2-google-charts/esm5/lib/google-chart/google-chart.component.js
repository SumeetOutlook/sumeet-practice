import { __awaiter, __decorate, __generator } from "tslib";
import { Component, ElementRef, OnInit, Input, Output, EventEmitter } from '@angular/core';
import { GoogleChartsLoaderService } from '../google-charts-loader.service';
import { GoogleChartsDataTable } from '../google-charts-datatable';
import { ChartHTMLTooltip } from './chart-html-tooltip';
var GoogleChartComponent = /** @class */ (function () {
    function GoogleChartComponent(el, loaderService) {
        var _this = this;
        this.el = el;
        this.mouseOverListener = function (item) {
            var event = _this.parseMouseEvent(item);
            event.tooltip = _this.getHTMLTooltip();
            return event;
        };
        this.mouseOutListener = function (item) {
            var event = _this.parseMouseEvent(item);
            return event;
        };
        this.selectListener = function () {
            var event = {
                message: 'select',
                row: null,
                column: null,
                selectedRowValues: [],
                selectedRowFormattedValues: [],
                columnLabel: ''
            };
            var s = _this.wrapper.visualization.getSelection();
            var gs = s[s.length - 1];
            if (!gs) {
                event.message = 'deselect';
                return event;
            }
            var selection = gs;
            if (gs.row != null) {
                event.row = selection.row;
                var selectedRowValues = [];
                var selectedRowFormattedValues = [];
                var dataTable = _this.wrapper.getDataTable();
                var numberOfColumns = dataTable.getNumberOfColumns();
                for (var i = 0; i < numberOfColumns; i++) {
                    selectedRowValues.push(dataTable.getValue(selection.row, i));
                    selectedRowFormattedValues.push(dataTable.getFormattedValue(selection.row, i));
                }
                event.selectedRowValues = selectedRowValues;
                event.selectedRowFormattedValues = selectedRowFormattedValues;
            }
            if (selection.column != null) {
                event.column = selection.column;
                event.columnLabel = _this.getColumnLabelAtPosition(selection);
            }
            if (gs.name) {
                event.columnLabel = gs.name;
            }
            return event;
        };
        this.loaderService = loaderService;
        this.chartSelect = new EventEmitter();
        this.chartSelectOneTime = new EventEmitter();
        this.chartReady = new EventEmitter();
        this.chartReadyOneTime = new EventEmitter();
        this.chartError = new EventEmitter();
        this.chartErrorOneTime = new EventEmitter();
        this.mouseOver = new EventEmitter();
        this.mouseOverOneTime = new EventEmitter();
        this.mouseOut = new EventEmitter();
        this.mouseOutOneTime = new EventEmitter();
        this.regionClick = new EventEmitter();
        this.regionClickOneTime = new EventEmitter();
    }
    GoogleChartComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.HTMLel = this.el.nativeElement.querySelector('div');
        this.data.component = this;
        this.options = this.data.options;
        this.init().then(function () {
            _this.draw();
        });
    };
    GoogleChartComponent.prototype.init = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.loaderService.load()];
                    case 1:
                        _a.sent();
                        this.recreateWrapper();
                        return [2 /*return*/];
                }
            });
        });
    };
    GoogleChartComponent.prototype.recreateWrapper = function () {
        var _this = this;
        if (this.wrapper === undefined || this.wrapper.getChartType() !== this.data.chartType) {
            this.dataTable = new GoogleChartsDataTable(this.data);
            this.dataTable.dataTableChanged.subscribe(function (dt) {
                _this._draw();
            });
            // see dataTable in https://developers.google.com/chart/interactive/docs/reference#google.visualization.drawchart
            var temp = this.data;
            if (this.data.firstRowIsData) {
                temp = Object.assign(temp, this.data);
                temp.dataTable = this.dataTable.getDataTable();
            }
            this.wrapper = new google.visualization.ChartWrapper(temp);
            this.registerChartWrapperEvents();
            /* Calling draw even without data is the only way to pass the HTMl element
               when using the chart in a dashboard. Don't do this in all other cases:
               it breaks formatters with remote data source, hence the conditional. */
            if (temp.dataTable === undefined && temp.dataSourceUrl === undefined) {
                try {
                    this.wrapper.draw(this.HTMLel);
                }
                catch (err) { }
            }
        }
    };
    GoogleChartComponent.prototype._draw = function () {
        return __awaiter(this, void 0, void 0, function () {
            var dt;
            return __generator(this, function (_a) {
                dt = this.dataTable.getDataTable();
                if (dt === undefined) {
                    return [2 /*return*/];
                }
                this.convertOptions();
                this.recreateWrapper();
                this.wrapper.setOptions(this.options);
                this.wrapper.setDataTable(dt);
                this.wrapper.draw(this.HTMLel);
                return [2 /*return*/];
            });
        });
    };
    GoogleChartComponent.prototype.getDataTable = function () {
        return this.dataTable;
    };
    GoogleChartComponent.prototype.draw = function (value) {
        if (value === undefined) {
            value = this.data;
        }
        this.options = value.options;
        this.dataTable.init(value);
    };
    GoogleChartComponent.prototype.getSelectorBySeriesType = function (seriesType) {
        var selectors = {
            bars: 'bar#%s#%r',
            haxis: 'hAxis#0#label',
            line: 'point#%s#%r',
            legend: 'legendentry#%s',
            area: 'point#%s#%r'
        };
        var selector = selectors[seriesType];
        return selector;
    };
    /**
     * Given a column number, counts how many
     * columns have rol=="data". Those are mapped
     * one-to-one to the series array. When rol is not defined
     * a column of type number means a series column.
     * @param column to inspect
     */
    GoogleChartComponent.prototype.getSeriesByColumn = function (column) {
        var series = 0;
        var dataTable = this.wrapper.getDataTable();
        for (var i = column - 1; i >= 0; i--) {
            var role = dataTable.getColumnRole(i);
            var type = dataTable.getColumnType(i);
            if (role === 'data' || type === 'number') {
                series++;
            }
        }
        return series;
    };
    GoogleChartComponent.prototype.getBoundingBoxForItem = function (item) {
        var boundingBox = { top: 0, left: 0, width: 0, height: 0 };
        if (this.cli) {
            var column = item.column;
            var series = this.getSeriesByColumn(column);
            var row = item.row;
            var seriesType = this.options.seriesType;
            if (this.options.series && this.options.series[series] && this.options.series[series].type) {
                seriesType = this.options.series[series].type;
            }
            if (seriesType) {
                var selector = this.getSelectorBySeriesType(seriesType);
                if (selector) {
                    selector = selector.replace('%s', series + '').replace('%c', column + '').replace('%r', row + '');
                    var box = this.cli.getBoundingBox(selector);
                    if (box) {
                        boundingBox = box;
                    }
                }
            }
        }
        return boundingBox;
    };
    GoogleChartComponent.prototype.getValueAtPosition = function (position) {
        if (position.row == null) {
            return null;
        }
        var dataTable = this.wrapper.getDataTable();
        var value = dataTable.getValue(position.row, position.column);
        return value;
    };
    GoogleChartComponent.prototype.getColumnTypeAtPosition = function (position) {
        var dataTable = this.wrapper.getDataTable();
        var type = dataTable.getColumnType(position.column) || '';
        return type;
    };
    GoogleChartComponent.prototype.getColumnLabelAtPosition = function (position) {
        var dataTable = this.wrapper.getDataTable();
        var type = dataTable.getColumnLabel(position.column) || '';
        return type;
    };
    GoogleChartComponent.prototype.getHTMLTooltip = function () {
        var tooltipER = new ElementRef(this.el.nativeElement.querySelector('.google-visualization-tooltip'));
        return new ChartHTMLTooltip(tooltipER);
    };
    GoogleChartComponent.prototype.parseMouseEvent = function (item) {
        var chartType = this.wrapper.getChartType();
        var eventColumn = item.column;
        if (eventColumn == null) {
            switch (chartType) {
                case 'Timeline':
                    eventColumn = this.wrapper.getDataTable().getNumberOfColumns() === 3 ? 0 : 1;
                    break;
                default:
                    eventColumn = 0;
            }
        }
        var eventRow = item.row;
        var myItem = {
            row: eventRow,
            column: eventColumn
        };
        var event = {
            position: item,
            boundingBox: this.getBoundingBoxForItem(myItem),
            value: this.getValueAtPosition(myItem),
            columnType: this.getColumnTypeAtPosition(myItem),
            columnLabel: this.getColumnLabelAtPosition(myItem)
        };
        return event;
    };
    GoogleChartComponent.prototype.unregisterEvents = function () {
        google.visualization.events.removeAllListeners(this.wrapper.getChart());
        google.visualization.events.removeAllListeners(this.wrapper);
    };
    GoogleChartComponent.prototype.registerChartEvents = function () {
        var _this = this;
        var chart = this.wrapper.getChart();
        this.cli = chart.getChartLayoutInterface ? chart.getChartLayoutInterface() : null;
        if (this.mouseOver.observers.length > 0) {
            google.visualization.events.addListener(chart, 'onmouseover', function (item) {
                var event = _this.parseMouseEvent(item);
                event.tooltip = _this.getHTMLTooltip();
                _this.mouseOver.emit(event);
            });
        }
        if (this.mouseOverOneTime.observers.length > 0) {
            google.visualization.events.addOneTimeListener(chart, 'onmouseover', function (item) {
                var event = _this.parseMouseEvent(item);
                event.tooltip = _this.getHTMLTooltip();
                _this.mouseOverOneTime.emit(event);
            });
        }
        if (this.mouseOut.observers.length > 0) {
            google.visualization.events.addListener(chart, 'onmouseout', function (item) {
                var event = _this.parseMouseEvent(item);
                _this.mouseOut.emit(event);
            });
        }
        if (this.mouseOutOneTime.observers.length > 0) {
            google.visualization.events.addOneTimeListener(chart, 'onmouseout', function (item) {
                var event = _this.parseMouseEvent(item);
                _this.mouseOutOneTime.emit(event);
            });
        }
        if (this.data.chartType === 'GeoChart') {
            if (this.regionClick.observers.length > 0) {
                google.visualization.events.addListener(chart, 'regionClick', function (item) {
                    _this.regionClick.emit(item);
                });
            }
            if (this.regionClickOneTime.observers.length > 0) {
                google.visualization.events.addOneTimeListener(chart, 'regionClick', function (item) {
                    _this.regionClick.emit(item);
                });
            }
        }
    };
    GoogleChartComponent.prototype.registerChartWrapperEvents = function () {
        var _this = this;
        google.visualization.events.addListener(this.wrapper, 'ready', function () {
            _this.chartReady.emit({ message: 'Chart ready' });
        });
        google.visualization.events.addOneTimeListener(this.wrapper, 'ready', function () {
            _this.chartReadyOneTime.emit({ message: 'Chart ready (one time)' });
            _this.registerChartEvents();
        });
        google.visualization.events.addListener(this.wrapper, 'error', function (error) {
            _this.chartError.emit(error);
        });
        google.visualization.events.addOneTimeListener(this.wrapper, 'error', function (error) {
            _this.chartErrorOneTime.emit(error);
        });
        this.addListener(this.wrapper, 'select', this.selectListener, this.chartSelect);
        this.addOneTimeListener(this.wrapper, 'select', this.selectListener, this.chartSelectOneTime);
    };
    GoogleChartComponent.prototype.addListener = function (source, eventType, listenerFn, evEmitter) {
        google.visualization.events.addListener(source, eventType, function () {
            evEmitter.emit(listenerFn());
        });
    };
    GoogleChartComponent.prototype.addOneTimeListener = function (source, eventType, listenerFn, evEmitter) {
        google.visualization.events.addOneTimeListener(source, eventType, function () {
            evEmitter.emit(listenerFn());
        });
    };
    GoogleChartComponent.prototype.convertOptions = function () {
        try {
            this.options = google.charts[this.data.chartType].convertOptions(this.options);
        }
        catch (error) {
            return;
        }
    };
    GoogleChartComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: GoogleChartsLoaderService }
    ]; };
    __decorate([
        Input()
    ], GoogleChartComponent.prototype, "data", void 0);
    __decorate([
        Output()
    ], GoogleChartComponent.prototype, "chartReady", void 0);
    __decorate([
        Output()
    ], GoogleChartComponent.prototype, "chartReadyOneTime", void 0);
    __decorate([
        Output()
    ], GoogleChartComponent.prototype, "chartError", void 0);
    __decorate([
        Output()
    ], GoogleChartComponent.prototype, "chartErrorOneTime", void 0);
    __decorate([
        Output()
    ], GoogleChartComponent.prototype, "chartSelect", void 0);
    __decorate([
        Output()
    ], GoogleChartComponent.prototype, "chartSelectOneTime", void 0);
    __decorate([
        Output()
    ], GoogleChartComponent.prototype, "mouseOver", void 0);
    __decorate([
        Output()
    ], GoogleChartComponent.prototype, "mouseOverOneTime", void 0);
    __decorate([
        Output()
    ], GoogleChartComponent.prototype, "mouseOut", void 0);
    __decorate([
        Output()
    ], GoogleChartComponent.prototype, "mouseOutOneTime", void 0);
    __decorate([
        Output()
    ], GoogleChartComponent.prototype, "regionClick", void 0);
    __decorate([
        Output()
    ], GoogleChartComponent.prototype, "regionClickOneTime", void 0);
    GoogleChartComponent = __decorate([
        Component({
            selector: 'google-chart',
            template: '<div></div>'
        })
    ], GoogleChartComponent);
    return GoogleChartComponent;
}());
export { GoogleChartComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ29vZ2xlLWNoYXJ0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nMi1nb29nbGUtY2hhcnRzLyIsInNvdXJjZXMiOlsibGliL2dvb2dsZS1jaGFydC9nb29nbGUtY2hhcnQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFFQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFVBQVUsRUFDVixNQUFNLEVBQ04sS0FBSyxFQUNMLE1BQU0sRUFDTixZQUFZLEVBQ2IsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDNUUsT0FBTyxFQUFFLHFCQUFxQixFQUFrQyxNQUFNLDRCQUE0QixDQUFDO0FBV25HLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBY3hEO0lBOEJFLDhCQUEyQixFQUFjLEVBQ3RCLGFBQXdDO1FBRDNELGlCQWVDO1FBZjBCLE9BQUUsR0FBRixFQUFFLENBQVk7UUF3UmpDLHNCQUFpQixHQUFHLFVBQUMsSUFBdUI7WUFDbEQsSUFBTSxLQUFLLEdBQXdCLEtBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUF3QixDQUFDO1lBQ3JGLEtBQUssQ0FBQyxPQUFPLEdBQUcsS0FBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ3RDLE9BQU8sS0FBSyxDQUFDO1FBQ2YsQ0FBQyxDQUFBO1FBRU8scUJBQWdCLEdBQUcsVUFBQyxJQUF1QjtZQUNqRCxJQUFNLEtBQUssR0FBdUIsS0FBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQXVCLENBQUM7WUFDbkYsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDLENBQUE7UUFFTyxtQkFBYyxHQUFHO1lBQ3ZCLElBQU0sS0FBSyxHQUFxQjtnQkFDOUIsT0FBTyxFQUFFLFFBQVE7Z0JBQ2pCLEdBQUcsRUFBRSxJQUFJO2dCQUNULE1BQU0sRUFBRSxJQUFJO2dCQUNaLGlCQUFpQixFQUFFLEVBQUU7Z0JBQ3JCLDBC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bUVBQXlEO0lBRXhEO1FBQVQsTUFBTSxFQUFFOzZEQUFvRDtJQUNuRDtRQUFULE1BQU0sRUFBRTtvRUFBMkQ7SUFFMUQ7UUFBVCxNQUFNLEVBQUU7MkRBQXFEO0lBQ3BEO1FBQVQsTUFBTSxFQUFFO2tFQUE0RDtJQUUzRDtRQUFULE1BQU0sRUFBRTswREFBbUQ7SUFDbEQ7UUFBVCxNQUFNLEVBQUU7aUVBQTBEO0lBRXpEO1FBQVQsTUFBTSxFQUFFOzZEQUFvRDtJQUNuRDtRQUFULE1BQU0sRUFBRTtvRUFBMkQ7SUFwQnpELG9CQUFvQjtRQUpoQyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsY0FBYztZQUN4QixRQUFRLEVBQUUsYUFBYTtTQUN4QixDQUFDO09BQ1csb0JBQW9CLENBaVhoQztJQUFELDJCQUFDO0NBQUEsQUFqWEQsSUFpWEM7U0FqWFksb0JBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiZGVjbGFyZSB2YXIgZ29vZ2xlOiBhbnk7XG5cbmltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgT25Jbml0LFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBFdmVudEVtaXR0ZXJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IEdvb2dsZUNoYXJ0c0xvYWRlclNlcnZpY2UgfSBmcm9tICcuLi9nb29nbGUtY2hhcnRzLWxvYWRlci5zZXJ2aWNlJztcbmltcG9ydCB7IEdvb2dsZUNoYXJ0c0RhdGFUYWJsZSwgR29vZ2xlQ2hhcnRzRGF0YVRhYmxlSW50ZXJmYWNlIH0gZnJvbSAnLi4vZ29vZ2xlLWNoYXJ0cy1kYXRhdGFibGUnO1xuaW1wb3J0IHsgQ2hhcnRSZWFkeUV2ZW50IH0gZnJvbSAnLi9jaGFydC1yZWFkeS1ldmVudCc7XG5pbXBvcnQgeyBDaGFydEVycm9yRXZlbnQgfSBmcm9tICcuL2NoYXJ0LWVycm9yLWV2ZW50JztcbmltcG9ydCB7IENoYXJ0U2VsZWN0RXZlbnQgfSBmcm9tICcuL2NoYXJ0LXNlbGVjdC1ldmVudCc7XG5pbXBvcnQge1xuICBDaGFydE1vdXNlRXZlbnQsXG4gIENoYXJ0TW91c2VPdmVyRXZlbnQsXG4gIENoYXJ0TW91c2VPdXRFdmVudCxcbiAgQm91bmRpbmdCb3gsXG4gIERhdGFQb2ludFBvc2l0aW9uXG59IGZyb20gJy4vY2hhcnQtbW91c2UtZXZlbnQnO1xuaW1wb3J0IHsgQ2hhcnRIVE1MVG9vbHRpcCB9IGZyb20gJy4vY2hhcnQtaHRtbC10b29sdGlwJztcbmltcG9ydCB7IFJlZ2lvbkNsaWNrRXZlbnQgfSBmcm9tICcuL2dlb2NoYXJ0LWV2ZW50cyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgR29vZ2xlQ2hhcnRJbnRlcmZhY2UgZXh0ZW5kcyBHb29nbGVDaGFydHNEYXRhVGFibGVJbnRlcmZhY2Uge1xuICBjaGFydFR5cGU6IHN0cmluZztcbiAgb3B0aW9ucz86IGFueTtcblxuICBjb21wb25lbnQ/OiBHb29nbGVDaGFydENvbXBvbmVudDtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnZ29vZ2xlLWNoYXJ0JyxcbiAgdGVtcGxhdGU6ICc8ZGl2PjwvZGl2PicsXG59KVxuZXhwb3J0IGNsYXNzIEdvb2dsZUNoYXJ0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICBASW5wdXQoKSBwdWJsaWMgZGF0YTogR29vZ2xlQ2hhcnRJbnRlcmZhY2U7XG5cbiAgQE91dHB1dCgpIHB1YmxpYyBjaGFydFJlYWR5OiBFdmVudEVtaXR0ZXI8Q2hhcnRSZWFkeUV2ZW50PjtcbiAgQE91dHB1dCgpIHB1YmxpYyBjaGFydFJlYWR5T25lVGltZTogRXZlbnRFbWl0dGVyPENoYXJ0UmVhZHlFdmVudD47XG5cbiAgQE91dHB1dCgpIHB1YmxpYyBjaGFydEVycm9yOiBFdmVudEVtaXR0ZXI8Q2hhcnRFcnJvckV2ZW50PjtcbiAgQE91dHB1dCgpIHB1YmxpYyBjaGFydEVycm9yT25lVGltZTogRXZlbnRFbWl0dGVyPENoYXJ0RXJyb3JFdmVudD47XG5cbiAgQE91dHB1dCgpIHB1YmxpYyBjaGFydFNlbGVjdDogRXZlbnRFbWl0dGVyPENoYXJ0U2VsZWN0RXZlbnQ+O1xuICBAT3V0cHV0KCkgcHVibGljIGNoYXJ0U2VsZWN0T25lVGltZTogRXZlbnRFbWl0dGVyPENoYXJ0U2VsZWN0RXZlbnQ+O1xuXG4gIEBPdXRwdXQoKSBwdWJsaWMgbW91c2VPdmVyOiBFdmVudEVtaXR0ZXI8Q2hhcnRNb3VzZU92ZXJFdmVudD47XG4gIEBPdXRwdXQoKSBwdWJsaWMgbW91c2VPdmVyT25lVGltZTogRXZlbnRFbWl0dGVyPENoYXJ0TW91c2VPdmVyRXZlbnQ+O1xuXG4gIEBPdXRwdXQoKSBwdWJsaWMgbW91c2VPdXQ6IEV2ZW50RW1pdHRlcjxDaGFydE1vdXNlT3V0RXZlbnQ+O1xuICBAT3V0cHV0KCkgcHVibGljIG1vdXNlT3V0T25lVGltZTogRXZlbnRFbWl0dGVyPENoYXJ0TW91c2VPdXRFdmVudD47XG5cbiAgQE91dHB1dCgpIHB1YmxpYyByZWdpb25DbGljazogRXZlbnRFbWl0dGVyPFJlZ2lvbkNsaWNrRXZlbnQ+O1xuICBAT3V0cHV0KCkgcHVibGljIHJlZ2lvbkNsaWNrT25lVGltZTogRXZlbnRFbWl0dGVyPFJlZ2lvbkNsaWNrRXZlbnQ+O1xuXG4gIHB1YmxpYyB3cmFwcGVyOiBhbnk7XG4gIHByaXZhdGUgY2xpOiBhbnk7XG4gIHByaXZhdGUgb3B0aW9uczogYW55O1xuXG4gIHByaXZhdGUgSFRNTGVsOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSBsb2FkZXJTZXJ2aWNlOiBHb29nbGVDaGFydHNMb2FkZXJTZXJ2aWNlO1xuICBwcml2YXRlIGRhdGFUYWJsZTogR29vZ2xlQ2hhcnRzRGF0YVRhYmxlO1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsOiBFbGVtZW50UmVmLFxuICAgICAgICAgICAgICAgICAgICAgbG9hZGVyU2VydmljZTogR29vZ2xlQ2hhcnRzTG9hZGVyU2VydmljZSkge1xuICAgIHRoaXMubG9hZGVyU2VydmljZSA9IGxvYWRlclNlcnZpY2U7XG4gICAgdGhpcy5jaGFydFNlbGVjdCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLmNoYXJ0U2VsZWN0T25lVGltZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLmNoYXJ0UmVhZHkgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgdGhpcy5jaGFydFJlYWR5T25lVGltZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLmNoYXJ0RXJyb3IgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgdGhpcy5jaGFydEVycm9yT25lVGltZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLm1vdXNlT3ZlciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLm1vdXNlT3Zlck9uZVRpbWUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgdGhpcy5tb3VzZU91dCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLm1vdXNlT3V0T25lVGltZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLnJlZ2lvbkNsaWNrID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIHRoaXMucmVnaW9uQ2xpY2tPbmVUaW1lID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICB9XG5cbiAgcHVibGljIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuSFRNTGVsID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2RpdicpO1xuICAgIHRoaXMuZGF0YS5jb21wb25lbnQgPSB0aGlzO1xuICAgIHRoaXMub3B0aW9ucyA9IHRoaXMuZGF0YS5vcHRpb25zO1xuXG4gICAgdGhpcy5pbml0KCkudGhlbigoKSA9PiB7XG4gICAgICB0aGlzLmRyYXcoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBpbml0KCkge1xuICAgIGF3YWl0IHRoaXMubG9hZGVyU2VydmljZS5sb2FkKCk7XG4gICAgdGhpcy5yZWNyZWF0ZVdyYXBwZXIoKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVjcmVhdGVXcmFwcGVyKCkge1xuICAgIGlmICh0aGlzLndyYXBwZXIgPT09IHVuZGVmaW5lZCB8fCB0aGlzLndyYXBwZXIuZ2V0Q2hhcnRUeXBlKCkgIT09IHRoaXMuZGF0YS5jaGFydFR5cGUpIHtcbiAgICAgIHRoaXMuZGF0YVRhYmxlID0gbmV3IEdvb2dsZUNoYXJ0c0RhdGFUYWJsZSh0aGlzLmRhdGEpO1xuICAgICAgdGhpcy5kYXRhVGFibGUuZGF0YVRhYmxlQ2hhbmdlZC5zdWJzY3JpYmUoKGR0OiBhbnkpID0+IHtcbiAgICAgICAgdGhpcy5fZHJhdygpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIHNlZSBkYXRhVGFibGUgaW4gaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vY2hhcnQvaW50ZXJhY3RpdmUvZG9jcy9yZWZlcmVuY2UjZ29vZ2xlLnZpc3VhbGl6YXRpb24uZHJhd2NoYXJ0XG4gICAgICBsZXQgdGVtcDogR29vZ2xlQ2hhcnRJbnRlcmZhY2UgPSB0aGlzLmRhdGE7XG4gICAgICBpZiAodGhpcy5kYXRhLmZpcnN0Um93SXNEYXRhKSB7XG4gICAgICAgIHRlbXAgPSBPYmplY3QuYXNzaWduKHRlbXAsIHRoaXMuZGF0YSk7XG4gICAgICAgIHRlbXAuZGF0YVRhYmxlID0gdGhpcy5kYXRhVGFibGUuZ2V0RGF0YVRhYmxlKCk7XG4gICAgICB9XG4gICAgICB0aGlzLndyYXBwZXIgPSBuZXcgZ29vZ2xlLnZpc3VhbGl6YXRpb24uQ2hhcnRXcmFwcGVyKHRlbXApO1xuICAgICAgdGhpcy5yZWdpc3RlckNoYXJ0V3JhcHBlckV2ZW50cygpO1xuXG4gICAgICAvKiBDYWxsaW5nIGRyYXcgZXZlbiB3aXRob3V0IGRhdGEgaXMgdGhlIG9ubHkgd2F5IHRvIHBhc3MgdGhlIEhUTWwgZWxlbWVudFxuICAgICAgICAgd2hlbiB1c2luZyB0aGUgY2hhcnQgaW4gYSBkYXNoYm9hcmQuIERvbid0IGRvIHRoaXMgaW4gYWxsIG90aGVyIGNhc2VzOlxuICAgICAgICAgaXQgYnJlYWtzIGZvcm1hdHRlcnMgd2l0aCByZW1vdGUgZGF0YSBzb3VyY2UsIGhlbmNlIHRoZSBjb25kaXRpb25hbC4gKi9cbiAgICAgIGlmICh0ZW1wLmRhdGFUYWJsZSA9PT0gdW5kZWZpbmVkICYmIHRlbXAuZGF0YVNvdXJjZVVybCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdGhpcy53cmFwcGVyLmRyYXcodGhpcy5IVE1MZWwpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHt9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBfZHJhdygpIHtcbiAgICBjb25zdCBkdCA9IHRoaXMuZGF0YVRhYmxlLmdldERhdGFUYWJsZSgpO1xuICAgIGlmIChkdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuY29udmVydE9wdGlvbnMoKTtcbiAgICB0aGlzLnJlY3JlYXRlV3JhcHBlcigpO1xuICAgIHRoaXMud3JhcHBlci5zZXRPcHRpb25zKHRoaXMub3B0aW9ucyk7XG4gICAgdGhpcy53cmFwcGVyLnNldERhdGFUYWJsZShkdCk7XG4gICAgdGhpcy53cmFwcGVyLmRyYXcodGhpcy5IVE1MZWwpO1xuICB9XG5cbiAgcHVibGljIGdldERhdGFUYWJsZSgpOiBHb29nbGVDaGFydHNEYXRhVGFibGUge1xuICAgIHJldHVybiB0aGlzLmRhdGFUYWJsZTtcbiAgfVxuXG4gIHB1YmxpYyBkcmF3KHZhbHVlPzogR29vZ2xlQ2hhcnRJbnRlcmZhY2UpIHtcbiAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdmFsdWUgPSB0aGlzLmRhdGE7XG4gICAgfVxuICAgIHRoaXMub3B0aW9ucyA9IHZhbHVlLm9wdGlvbnM7XG4gICAgdGhpcy5kYXRhVGFibGUuaW5pdCh2YWx1ZSk7XG4gIH1cblxuICBwcml2YXRlIGdldFNlbGVjdG9yQnlTZXJpZXNUeXBlKHNlcmllc1R5cGU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3Qgc2VsZWN0b3JzOiBhbnkgPSB7XG4gICAgICBiYXJzIDogJ2JhciMlcyMlcicsXG4gICAgICBoYXhpcyA6ICdoQXhpcyMwI2xhYmVsJyxcbiAgICAgIGxpbmU6ICdwb2ludCMlcyMlcicsXG4gICAgICBsZWdlbmQgOiAnbGVnZW5kZW50cnkjJXMnLFxuICAgICAgYXJlYTogJ3BvaW50IyVzIyVyJ1xuICAgIH07XG5cbiAgICBjb25zdCBzZWxlY3Rvcjogc3RyaW5nID0gc2VsZWN0b3JzW3Nlcmllc1R5cGVdO1xuXG4gICAgcmV0dXJuIHNlbGVjdG9yO1xuICB9XG5cbiAvKipcbiAgKiBHaXZlbiBhIGNvbHVtbiBudW1iZXIsIGNvdW50cyBob3cgbWFueVxuICAqIGNvbHVtbnMgaGF2ZSByb2w9PVwiZGF0YVwiLiBUaG9zZSBhcmUgbWFwcGVkXG4gICogb25lLXRvLW9uZSB0byB0aGUgc2VyaWVzIGFycmF5LiBXaGVuIHJvbCBpcyBub3QgZGVmaW5lZFxuICAqIGEgY29sdW1uIG9mIHR5cGUgbnVtYmVyIG1lYW5zIGEgc2VyaWVzIGNvbHVtbi5cbiAgKiBAcGFyYW0gY29sdW1uIHRvIGluc3BlY3RcbiAgKi9cbiAgcHJpdmF0ZSBnZXRTZXJpZXNCeUNvbHVtbihjb2x1bW46IG51bWJlcik6IG51bWJlciAge1xuICAgIGxldCBzZXJpZXMgPSAwO1xuICAgIGNvbnN0IGRhdGFUYWJsZSA9IHRoaXMud3JhcHBlci5nZXREYXRhVGFibGUoKTtcbiAgICBmb3IgKGxldCBpID0gY29sdW1uIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIGNvbnN0IHJvbGUgPSBkYXRhVGFibGUuZ2V0Q29sdW1uUm9sZShpKTtcbiAgICAgIGNvbnN0IHR5cGUgPSBkYXRhVGFibGUuZ2V0Q29sdW1uVHlwZShpKTtcbiAgICAgIGlmIChyb2xlID09PSAnZGF0YScgfHwgdHlwZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgc2VyaWVzKys7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBzZXJpZXM7XG4gIH1cblxuICBwcml2YXRlIGdldEJvdW5kaW5nQm94Rm9ySXRlbShpdGVtOiBEYXRhUG9pbnRQb3NpdGlvbik6IEJvdW5kaW5nQm94IHtcbiAgICBsZXQgYm91bmRpbmdCb3ggPSB7dG9wOiAwLCBsZWZ0OiAwLCB3aWR0aDogMCwgaGVpZ2h0OiAwfTtcbiAgICBpZiAodGhpcy5jbGkpIHtcbiAgICAgIGNvbnN0IGNvbHVtbiA9IGl0ZW0uY29sdW1uO1xuICAgICAgY29uc3Qgc2VyaWVzID0gdGhpcy5nZXRTZXJpZXNCeUNvbHVtbihjb2x1bW4pO1xuICAgICAgY29uc3Qgcm93ID0gaXRlbS5yb3c7XG4gICAgICBsZXQgc2VyaWVzVHlwZSA9IHRoaXMub3B0aW9ucy5zZXJpZXNUeXBlO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5zZXJpZXMgJiYgdGhpcy5vcHRpb25zLnNlcmllc1tzZXJpZXNdICYmIHRoaXMub3B0aW9ucy5zZXJpZXNbc2VyaWVzXS50eXBlKSB7XG4gICAgICAgIHNlcmllc1R5cGUgPSB0aGlzLm9wdGlvbnMuc2VyaWVzW3Nlcmllc10udHlwZTtcbiAgICAgIH1cbiAgICAgIGlmIChzZXJpZXNUeXBlKSB7XG4gICAgICAgIGxldCBzZWxlY3RvciA9IHRoaXMuZ2V0U2VsZWN0b3JCeVNlcmllc1R5cGUoc2VyaWVzVHlwZSk7XG4gICAgICAgIGlmIChzZWxlY3Rvcikge1xuICAgICAgICAgICAgIHNlbGVjdG9yID0gc2VsZWN0b3IucmVwbGFjZSgnJXMnLCBzZXJpZXMgKyAnJykucmVwbGFjZSgnJWMnLCBjb2x1bW4gKyAnJykucmVwbGFjZSgnJXInLCByb3cgKyAnJyk7XG4gICAgICAgICAgICAgY29uc3QgYm94ID0gdGhpcy5jbGkuZ2V0Qm91bmRpbmdCb3goc2VsZWN0b3IpO1xuICAgICAgICAgICAgIGlmIChib3gpIHtcbiAgICAgICAgICAgICAgYm91bmRpbmdCb3ggPSBib3g7XG4gICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGJvdW5kaW5nQm94O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRWYWx1ZUF0UG9zaXRpb24ocG9zaXRpb246IERhdGFQb2ludFBvc2l0aW9uKTogYW55IHtcbiAgICBpZiAocG9zaXRpb24ucm93ID09IG51bGwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBkYXRhVGFibGUgPSB0aGlzLndyYXBwZXIuZ2V0RGF0YVRhYmxlKCk7XG4gICAgY29uc3QgdmFsdWUgPSBkYXRhVGFibGUuZ2V0VmFsdWUocG9zaXRpb24ucm93LCBwb3NpdGlvbi5jb2x1bW4pO1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29sdW1uVHlwZUF0UG9zaXRpb24ocG9zaXRpb246IERhdGFQb2ludFBvc2l0aW9uKTogc3RyaW5nIHtcbiAgICAgIGNvbnN0IGRhdGFUYWJsZSA9IHRoaXMud3JhcHBlci5nZXREYXRhVGFibGUoKTtcbiAgICAgIGNvbnN0IHR5cGUgPSBkYXRhVGFibGUuZ2V0Q29sdW1uVHlwZShwb3NpdGlvbi5jb2x1bW4pIHx8ICcnO1xuICAgICAgcmV0dXJuIHR5cGU7XG4gIH1cblxuICBwcml2YXRlIGdldENvbHVtbkxhYmVsQXRQb3NpdGlvbihwb3NpdGlvbjogRGF0YVBvaW50UG9zaXRpb24pOiBzdHJpbmcge1xuICAgICAgY29uc3QgZGF0YVRhYmxlID0gdGhpcy53cmFwcGVyLmdldERhdGFUYWJsZSgpO1xuICAgICAgY29uc3QgdHlwZSA9IGRhdGFUYWJsZS5nZXRDb2x1bW5MYWJlbChwb3NpdGlvbi5jb2x1bW4pIHx8ICcnO1xuICAgICAgcmV0dXJuIHR5cGU7XG4gIH1cblxuICBwcml2YXRlIGdldEhUTUxUb29sdGlwKCk6IENoYXJ0SFRNTFRvb2x0aXAge1xuICAgIGNvbnN0IHRvb2x0aXBFUiA9IG5ldyBFbGVtZW50UmVmKHRoaXMuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZ29vZ2xlLXZpc3VhbGl6YXRpb24tdG9vbHRpcCcpKTtcbiAgICByZXR1cm4gbmV3IENoYXJ0SFRNTFRvb2x0aXAodG9vbHRpcEVSKTtcbiAgfVxuXG4gIHByaXZhdGUgcGFyc2VNb3VzZUV2ZW50KGl0ZW06IERhdGFQb2ludFBvc2l0aW9uKTogQ2hhcnRNb3VzZUV2ZW50IHtcbiAgICBjb25zdCBjaGFydFR5cGUgPSB0aGlzLndyYXBwZXIuZ2V0Q2hhcnRUeXBlKCk7XG4gICAgbGV0IGV2ZW50Q29sdW1uID0gaXRlbS5jb2x1bW47XG4gICAgaWYgKGV2ZW50Q29sdW1uID09IG51bGwpIHtcbiAgICAgIHN3aXRjaCAoY2hhcnRUeXBlKSB7XG4gICAgICAgIGNhc2UgJ1RpbWVsaW5lJzpcbiAgICAgICAgICBldmVudENvbHVtbiA9IHRoaXMud3JhcHBlci5nZXREYXRhVGFibGUoKS5nZXROdW1iZXJPZkNvbHVtbnMoKSA9PT0gMyA/IDAgOiAxO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGV2ZW50Q29sdW1uID0gMDtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgZXZlbnRSb3cgPSBpdGVtLnJvdztcbiAgICBjb25zdCBteUl0ZW0gPSB7XG4gICAgICByb3c6IGV2ZW50Um93LFxuICAgICAgY29sdW1uOiBldmVudENvbHVtblxuICAgIH07XG4gICAgY29uc3QgZXZlbnQgPSB7XG4gICAgICBwb3NpdGlvbjogaXRlbSxcbiAgICAgIGJvdW5kaW5nQm94OiB0aGlzLmdldEJvdW5kaW5nQm94Rm9ySXRlbShteUl0ZW0pLFxuICAgICAgdmFsdWU6IHRoaXMuZ2V0VmFsdWVBdFBvc2l0aW9uKG15SXRlbSksXG4gICAgICBjb2x1bW5UeXBlOiB0aGlzLmdldENvbHVtblR5cGVBdFBvc2l0aW9uKG15SXRlbSksXG4gICAgICBjb2x1bW5MYWJlbDogdGhpcy5nZXRDb2x1bW5MYWJlbEF0UG9zaXRpb24obXlJdGVtKVxuICAgIH07XG4gICAgcmV0dXJuIGV2ZW50O1xuICB9XG5cbiAgcHJpdmF0ZSB1bnJlZ2lzdGVyRXZlbnRzKCk6IHZvaWQge1xuICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5yZW1vdmVBbGxMaXN0ZW5lcnModGhpcy53cmFwcGVyLmdldENoYXJ0KCkpO1xuICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5yZW1vdmVBbGxMaXN0ZW5lcnModGhpcy53cmFwcGVyKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJDaGFydEV2ZW50cygpOiB2b2lkIHtcbiAgICBjb25zdCBjaGFydCA9IHRoaXMud3JhcHBlci5nZXRDaGFydCgpO1xuICAgIHRoaXMuY2xpID0gY2hhcnQuZ2V0Q2hhcnRMYXlvdXRJbnRlcmZhY2UgPyBjaGFydC5nZXRDaGFydExheW91dEludGVyZmFjZSgpIDogbnVsbDtcbiAgICBpZiAodGhpcy5tb3VzZU92ZXIub2JzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRMaXN0ZW5lcihjaGFydCwgJ29ubW91c2VvdmVyJywgKGl0ZW06IERhdGFQb2ludFBvc2l0aW9uKSA9PiB7XG4gICAgICAgIGNvbnN0IGV2ZW50OiBDaGFydE1vdXNlT3ZlckV2ZW50ID0gdGhpcy5wYXJzZU1vdXNlRXZlbnQoaXRlbSkgYXMgQ2hhcnRNb3VzZU92ZXJFdmVudDtcbiAgICAgICAgZXZlbnQudG9vbHRpcCA9IHRoaXMuZ2V0SFRNTFRvb2x0aXAoKTtcbiAgICAgICAgdGhpcy5tb3VzZU92ZXIuZW1pdChldmVudCk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHRoaXMubW91c2VPdmVyT25lVGltZS5vYnNlcnZlcnMubGVuZ3RoID4gMCkge1xuICAgICAgZ29vZ2xlLnZpc3VhbGl6YXRpb24uZXZlbnRzLmFkZE9uZVRpbWVMaXN0ZW5lcihjaGFydCwgJ29ubW91c2VvdmVyJywgKGl0ZW06IERhdGFQb2ludFBvc2l0aW9uKSA9PiB7XG4gICAgICAgIGNvbnN0IGV2ZW50OiBDaGFydE1vdXNlT3ZlckV2ZW50ID0gdGhpcy5wYXJzZU1vdXNlRXZlbnQoaXRlbSkgYXMgQ2hhcnRNb3VzZU92ZXJFdmVudDtcbiAgICAgICAgZXZlbnQudG9vbHRpcCA9IHRoaXMuZ2V0SFRNTFRvb2x0aXAoKTtcbiAgICAgICAgdGhpcy5tb3VzZU92ZXJPbmVUaW1lLmVtaXQoZXZlbnQpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMubW91c2VPdXQub2JzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRMaXN0ZW5lcihjaGFydCwgJ29ubW91c2VvdXQnLCAoaXRlbTogRGF0YVBvaW50UG9zaXRpb24pID0+IHtcbiAgICAgICAgY29uc3QgZXZlbnQ6IENoYXJ0TW91c2VPdXRFdmVudCA9IHRoaXMucGFyc2VNb3VzZUV2ZW50KGl0ZW0pIGFzIENoYXJ0TW91c2VPdXRFdmVudDtcbiAgICAgICAgdGhpcy5tb3VzZU91dC5lbWl0KGV2ZW50KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm1vdXNlT3V0T25lVGltZS5vYnNlcnZlcnMubGVuZ3RoID4gMCkge1xuICAgICAgZ29vZ2xlLnZpc3VhbGl6YXRpb24uZXZlbnRzLmFkZE9uZVRpbWVMaXN0ZW5lcihjaGFydCwgJ29ubW91c2VvdXQnLCAoaXRlbTogRGF0YVBvaW50UG9zaXRpb24pID0+IHtcbiAgICAgICAgY29uc3QgZXZlbnQ6IENoYXJ0TW91c2VPdXRFdmVudCA9IHRoaXMucGFyc2VNb3VzZUV2ZW50KGl0ZW0pIGFzIENoYXJ0TW91c2VPdXRFdmVudDtcbiAgICAgICAgdGhpcy5tb3VzZU91dE9uZVRpbWUuZW1pdChldmVudCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5kYXRhLmNoYXJ0VHlwZSA9PT0gJ0dlb0NoYXJ0Jykge1xuICAgICAgaWYgKHRoaXMucmVnaW9uQ2xpY2sub2JzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZ29vZ2xlLnZpc3VhbGl6YXRpb24uZXZlbnRzLmFkZExpc3RlbmVyKGNoYXJ0LCAncmVnaW9uQ2xpY2snLCAoaXRlbTogUmVnaW9uQ2xpY2tFdmVudCkgPT4ge1xuICAgICAgICAgIHRoaXMucmVnaW9uQ2xpY2suZW1pdChpdGVtKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5yZWdpb25DbGlja09uZVRpbWUub2JzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZ29vZ2xlLnZpc3VhbGl6YXRpb24uZXZlbnRzLmFkZE9uZVRpbWVMaXN0ZW5lcihjaGFydCwgJ3JlZ2lvbkNsaWNrJywgKGl0ZW06IFJlZ2lvbkNsaWNrRXZlbnQpID0+IHtcbiAgICAgICAgICB0aGlzLnJlZ2lvbkNsaWNrLmVtaXQoaXRlbSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJDaGFydFdyYXBwZXJFdmVudHMoKTogdm9pZCB7XG4gICAgZ29vZ2xlLnZpc3VhbGl6YXRpb24uZXZlbnRzLmFkZExpc3RlbmVyKHRoaXMud3JhcHBlciwgJ3JlYWR5JywgKCkgPT4ge1xuICAgICAgdGhpcy5jaGFydFJlYWR5LmVtaXQoe21lc3NhZ2U6ICdDaGFydCByZWFkeSd9KTtcbiAgICB9KTtcblxuICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRPbmVUaW1lTGlzdGVuZXIodGhpcy53cmFwcGVyLCAncmVhZHknLCAoKSA9PiB7XG4gICAgICB0aGlzLmNoYXJ0UmVhZHlPbmVUaW1lLmVtaXQoe21lc3NhZ2U6ICdDaGFydCByZWFkeSAob25lIHRpbWUpJ30pO1xuICAgICAgdGhpcy5yZWdpc3RlckNoYXJ0RXZlbnRzKCk7XG4gICAgfSk7XG5cbiAgICBnb29nbGUudmlzdWFsaXphdGlvbi5ldmVudHMuYWRkTGlzdGVuZXIodGhpcy53cmFwcGVyLCAnZXJyb3InLCAoZXJyb3I6IGFueSkgPT4ge1xuICAgICAgdGhpcy5jaGFydEVycm9yLmVtaXQoZXJyb3IgYXMgQ2hhcnRFcnJvckV2ZW50KTtcbiAgICB9KTtcblxuICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRPbmVUaW1lTGlzdGVuZXIodGhpcy53cmFwcGVyLCAnZXJyb3InLCAoZXJyb3I6IGFueSkgPT4ge1xuICAgICAgdGhpcy5jaGFydEVycm9yT25lVGltZS5lbWl0KGVycm9yIGFzIENoYXJ0RXJyb3JFdmVudCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmFkZExpc3RlbmVyKHRoaXMud3JhcHBlciwgJ3NlbGVjdCcsIHRoaXMuc2VsZWN0TGlzdGVuZXIsIHRoaXMuY2hhcnRTZWxlY3QpO1xuICAgIHRoaXMuYWRkT25lVGltZUxpc3RlbmVyKHRoaXMud3JhcHBlciwgJ3NlbGVjdCcsIHRoaXMuc2VsZWN0TGlzdGVuZXIsIHRoaXMuY2hhcnRTZWxlY3RPbmVUaW1lKTtcbiAgfVxuXG4gIHByaXZhdGUgYWRkTGlzdGVuZXIoc291cmNlOiBhbnksIGV2ZW50VHlwZTogc3RyaW5nLCBsaXN0ZW5lckZuOiBhbnksIGV2RW1pdHRlcjogRXZlbnRFbWl0dGVyPGFueT4pIHtcbiAgICBnb29nbGUudmlzdWFsaXphdGlvbi5ldmVudHMuYWRkTGlzdGVuZXIoc291cmNlLCBldmVudFR5cGUsICgpID0+IHtcbiAgICAgIGV2RW1pdHRlci5lbWl0KGxpc3RlbmVyRm4oKSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFkZE9uZVRpbWVMaXN0ZW5lcihzb3VyY2U6IGFueSwgZXZlbnRUeXBlOiBzdHJpbmcsIGxpc3RlbmVyRm46IGFueSwgZXZFbWl0dGVyOiBFdmVudEVtaXR0ZXI8YW55Pikge1xuICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRPbmVUaW1lTGlzdGVuZXIoc291cmNlLCBldmVudFR5cGUsICgpID0+IHtcbiAgICAgIGV2RW1pdHRlci5lbWl0KGxpc3RlbmVyRm4oKSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIG1vdXNlT3Zlckxpc3RlbmVyID0gKGl0ZW06IERhdGFQb2ludFBvc2l0aW9uKSA9PiB7XG4gICAgY29uc3QgZXZlbnQ6IENoYXJ0TW91c2VPdmVyRXZlbnQgPSB0aGlzLnBhcnNlTW91c2VFdmVudChpdGVtKSBhcyBDaGFydE1vdXNlT3ZlckV2ZW50O1xuICAgIGV2ZW50LnRvb2x0aXAgPSB0aGlzLmdldEhUTUxUb29sdGlwKCk7XG4gICAgcmV0dXJuIGV2ZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBtb3VzZU91dExpc3RlbmVyID0gKGl0ZW06IERhdGFQb2ludFBvc2l0aW9uKSA9PiB7XG4gICAgY29uc3QgZXZlbnQ6IENoYXJ0TW91c2VPdXRFdmVudCA9IHRoaXMucGFyc2VNb3VzZUV2ZW50KGl0ZW0pIGFzIENoYXJ0TW91c2VPdXRFdmVudDtcbiAgICByZXR1cm4gZXZlbnQ7XG4gIH1cblxuICBwcml2YXRlIHNlbGVjdExpc3RlbmVyID0gKCkgPT4ge1xuICAgIGNvbnN0IGV2ZW50OiBDaGFydFNlbGVjdEV2ZW50ID0ge1xuICAgICAgbWVzc2FnZTogJ3NlbGVjdCcsXG4gICAgICByb3c6IG51bGwsXG4gICAgICBjb2x1bW46IG51bGwsXG4gICAgICBzZWxlY3RlZFJvd1ZhbHVlczogW10sXG4gICAgICBzZWxlY3RlZFJvd0Zvcm1hdHRlZFZhbHVlczogW10sXG4gICAgICBjb2x1bW5MYWJlbDogJydcbiAgICB9O1xuICAgIGNvbnN0IHMgPSB0aGlzLndyYXBwZXIudmlzdWFsaXphdGlvbi5nZXRTZWxlY3Rpb24oKTtcbiAgICBjb25zdCBncyA9IHNbcy5sZW5ndGggLSAxXTtcbiAgICBpZiAoIWdzKSB7XG4gICAgICBldmVudC5tZXNzYWdlID0gJ2Rlc2VsZWN0JztcbiAgICAgIHJldHVybiBldmVudDtcbiAgICB9XG4gICAgY29uc3Qgc2VsZWN0aW9uOiBEYXRhUG9pbnRQb3NpdGlvbiA9IGdzO1xuICAgIGlmIChncy5yb3cgIT0gbnVsbCkge1xuICAgICAgZXZlbnQucm93ID0gc2VsZWN0aW9uLnJvdztcblxuICAgICAgY29uc3Qgc2VsZWN0ZWRSb3dWYWx1ZXMgPSBbXTtcbiAgICAgIGNvbnN0IHNlbGVjdGVkUm93Rm9ybWF0dGVkVmFsdWVzID0gW107XG4gICAgICBjb25zdCBkYXRhVGFibGUgPSB0aGlzLndyYXBwZXIuZ2V0RGF0YVRhYmxlKCk7XG4gICAgICBjb25zdCBudW1iZXJPZkNvbHVtbnMgPSBkYXRhVGFibGUuZ2V0TnVtYmVyT2ZDb2x1bW5zKCk7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bWJlck9mQ29sdW1uczsgaSsrKSB7XG4gICAgICAgIHNlbGVjdGVkUm93VmFsdWVzLnB1c2goZGF0YVRhYmxlLmdldFZhbHVlKHNlbGVjdGlvbi5yb3csIGkpKTtcbiAgICAgICAgc2VsZWN0ZWRSb3dGb3JtYXR0ZWRWYWx1ZXMucHVzaChkYXRhVGFibGUuZ2V0Rm9ybWF0dGVkVmFsdWUoc2VsZWN0aW9uLnJvdywgaSkpO1xuICAgICAgfVxuICAgICAgZXZlbnQuc2VsZWN0ZWRSb3dWYWx1ZXMgPSBzZWxlY3RlZFJvd1ZhbHVlcztcbiAgICAgIGV2ZW50LnNlbGVjdGVkUm93Rm9ybWF0dGVkVmFsdWVzID0gc2VsZWN0ZWRSb3dGb3JtYXR0ZWRWYWx1ZXM7XG4gICAgfVxuICAgIGlmIChzZWxlY3Rpb24uY29sdW1uICE9IG51bGwpIHtcbiAgICAgIGV2ZW50LmNvbHVtbiA9IHNlbGVjdGlvbi5jb2x1bW47XG4gICAgICBldmVudC5jb2x1bW5MYWJlbCA9IHRoaXMuZ2V0Q29sdW1uTGFiZWxBdFBvc2l0aW9uKHNlbGVjdGlvbik7XG4gICAgfVxuICAgIGlmIChncy5uYW1lKSB7XG4gICAgICBldmVudC5jb2x1bW5MYWJlbCA9IGdzLm5hbWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGV2ZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBjb252ZXJ0T3B0aW9ucygpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5vcHRpb25zID0gZ29vZ2xlLmNoYXJ0c1t0aGlzLmRhdGEuY2hhcnRUeXBlXS5jb252ZXJ0T3B0aW9ucyh0aGlzLm9wdGlvbnMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG59XG4iXX0=